<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Digital</title>
    <!-- Incluimos Tailwind CSS desde un CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Peque√±o estilo adicional para una fuente de reloj m√°s bonita */
      @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap");
      .font-orbitron {
        font-family: "Orbitron", sans-serif;
      }
    </style>
    <link rel="manifest" href="manifest.json">
  </head>

  <body
    class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4"
  >
    <main class="w-full max-w-4xl mx-auto flex flex-col flex-grow space-y-4">
      <!-- 1. Secci√≥n del Reloj y la Fecha -->
      <section class="flex-grow bg-gray-800 p-6 rounded-xl shadow-lg text-center flex flex-col justify-center">
        <div
          id="time"
          class="font-orbitron text-7xl md:text-8xl lg:text-9xl font-bold tracking-widest"
        >
          00:00:00
        </div>
        <div id="date" class="text-xl md:text-2xl text-gray-400 mt-4">
          cargando fecha...
        </div>
      </section>

      <!-- 2. Secci√≥n del Clima -->
      <section
        id="weather-container"
        class="bg-gray-800 p-4 rounded-xl shadow-lg flex items-center justify-center space-x-2 text-sm"
      >
        <div id="weather-icon" class="text-2xl"></div>
        <div>
          <div id="temperature" class="text-lg font-bold">--¬∞C</div>
          <div id="weather-description" class="text-gray-400">
            Obteniendo clima...
          </div>
        </div>
      </section>

      </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const timeEl = document.getElementById("time");
        const dateEl = document.getElementById("date");
        const weatherIconEl = document.getElementById("weather-icon");
        const tempEl = document.getElementById("temperature");
        const weatherDescEl = document.getElementById("weather-description");

        // --- 1. FUNCI√ìN PARA EL RELOJ Y LA FECHA ---
        function updateTimeAndDate() {
          const now = new Date();
          const hours = String(now.getHours()).padStart(2, "0");
          const minutes = String(now.getMinutes()).padStart(2, "0");
          const seconds = String(now.getSeconds()).padStart(2, "0");
          timeEl.textContent = `${hours}:${minutes}:${seconds}`;

          const dateOptions = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          dateEl.textContent = now.toLocaleDateString("es-ES", dateOptions);
        }

        // --- FUNCI√ìN AUXILIAR PARA INTERPRETAR C√ìDIGOS DE CLIMA (WMO) ---
        function getWeatherInfoFromCode(code) {
          const weatherMap = {
            0: { description: "Despejado", icon: "‚òÄÔ∏è" },
            1: { description: "Mayormente despejado", icon: "üå§Ô∏è" },
            2: { description: "Parcialmente nublado", icon: "‚õÖ" },
            3: { description: "Nublado", icon: "‚òÅÔ∏è" },
            45: { description: "Niebla", icon: "üå´Ô∏è" },
            48: { description: "Niebla con escarcha", icon: "üå´Ô∏è‚ùÑÔ∏è" },
            51: { description: "Llovizna ligera", icon: "üå¶Ô∏è" },
            53: { description: "Llovizna moderada", icon: "üå¶Ô∏è" },
            55: { description: "Llovizna densa", icon: "üå¶Ô∏è" },
            61: { description: "Lluvia ligera", icon: "üåßÔ∏è" },
            63: { description: "Lluvia moderada", icon: "üåßÔ∏è" },
            65: { description: "Lluvia fuerte", icon: "üåßÔ∏è" },
            71: { description: "Nieve ligera", icon: "‚ùÑÔ∏è" },
            73: { description: "Nieve moderada", icon: "‚ùÑÔ∏è" },
            75: { description: "Nieve fuerte", icon: "‚ùÑÔ∏è" },
            80: { description: "Chubascos ligeros", icon: "üåßÔ∏è" },
            81: { description: "Chubascos moderados", icon: "üåßÔ∏è" },
            82: { description: "Chubascos violentos", icon: "‚õàÔ∏è" },
            95: { description: "Tormenta el√©ctrica", icon: "‚õàÔ∏è" },
            96: { description: "Tormenta con granizo", icon: "‚õàÔ∏èüßä" },
            99: { description: "Tormenta con granizo", icon: "‚õàÔ∏èüßä" },
          };
          return weatherMap[code] || { description: "Desconocido", icon: "‚ùì" };
        }

        // --- 2. FUNCI√ìN PARA EL CLIMA (USANDO OPEN-METEO) ---
        async function fetchWeather(latitude, longitude, locationName = null) {
          const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&timezone=auto`;
          try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("Respuesta de red no fue exitosa.");

            const data = await response.json();
            const currentTemp = data.current.temperature_2m;
            const weatherCode = data.current.weather_code;
            const weatherInfo = getWeatherInfoFromCode(weatherCode);

            weatherIconEl.textContent = weatherInfo.icon;
            tempEl.textContent = `${Math.round(currentTemp)}¬∞C`;
            // Si se proporciona un nombre de ubicaci√≥n (como la de por defecto), lo mostramos.
            weatherDescEl.textContent = locationName ? `${weatherInfo.description} en ${locationName}` : weatherInfo.description;

          } catch (error) {
            weatherDescEl.textContent = "Error al obtener datos";
            console.error("Error fetching weather:", error);
          }
        }

        function getWeather() {
          const options = {
            enableHighAccuracy: false,
            timeout: 10000,
            maximumAge: 0,
          };

          const defaultLocation = {
            latitude: 4.583333,
            longitude: -74.216667,
            name: "Soacha",
          };

          navigator.geolocation.getCurrentPosition(
            // √âxito al obtener ubicaci√≥n
            (position) => {
              fetchWeather(position.coords.latitude, position.coords.longitude);
            },
            // Error al obtener ubicaci√≥n
            (error) => {
              console.error("Geolocation error:", error);
              // Mostramos un mensaje y luego el clima de la ubicaci√≥n por defecto.
              weatherDescEl.textContent = "Usando ubicaci√≥n por defecto.";
              fetchWeather(defaultLocation.latitude, defaultLocation.longitude, defaultLocation.name);
            },
            options
          );
        }

        // --- INICIALIZACI√ìN ---
        updateTimeAndDate();
        setInterval(updateTimeAndDate, 1000);
        getWeather();
      });
    </script>
  <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, err => {
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>
